"use strict";var csbc={};!function(){function n(e){var t;return _.isArray(e)?t=_.map(e,function(e){if(!_.isObject(e)||"function"==typeof e)return _.isDate(e)?new Date(e):e;var t=n(e);return t}):(t={},_.each(e,function(e,t){if(_.isObject(e)&&"function"!=typeof e)if(_.isDate(e))this[t]=new Date(e.valueOf());else{var r=n(e);this[t]=r}else this[t]=e},t)),t}function e(e){if(!_.isObject(e)||"function"==typeof e)return _.isDate(e)?new Date(e):e;var t=n(e);return t}csbc.deepClone=e}(),function(){function n(n){throw new Error(n)}function e(n,e){var t=function(){return e.apply(e,arguments)};return t.message=n,t}function t(){var n=_.toArray(arguments),e=function(e){return _.every(n,function(n){return _.has(e,n)})};return e.message=_.cat(["以下のキーが存在する必要があります:"],n).join(" "),e}function r(n,e){var t=function(t){return _.has(t,n)&&_.some(e,function(e){return t[n]===e})};return t.message=_.cat(["プロパティ"+n+"の値は以下のどれかである必要があります:"],e).join(" "),t}function u(n){return function(e){return _.truthy(e)&&_.isArray(e)&&_.every(e,function(e){return n(e)})}}function i(){var e=_.toArray(arguments);return function(t){var r=_.rest(arguments),u=_.mapcat(r,function(n,t){return _.exists(e[t])&&_.isArray(e[t])?_.mapcat(e[t],function(e){return e(n)?void 0:[e.message]}):void 0}),i=_.filter(u,function(n){return _.truthy(n)});return 0!==i.length&&n(i.join()),t.apply(t,r)}}function o(e,t){return function(){var r=_.toArray(arguments);try{return e.apply(e,r)}catch(u){return _.isFunction(t)?t(u):n(u)}}}function c(){var n=_.isArray(arguments[0])?arguments[0]:arguments;return function(e){var t=_.rest(arguments);return _.reduce(n,function(n,e){return e.apply(e,_.cat([n],t))},e)}}function a(n){var e=_.rest(arguments);_.each(n,function(n){n.apply(n,e)})}function s(n){return function(e){return!_.exists(e)||n(e)}}function f(n,e,t){return _.isNumber(n)&&n>=e&&t>=n}function d(n,e){return _.truthy(n)||(n=e),n}function l(n,e,t,r){function u(n){return _.isEqual(n,A)?!1:(A=n,!0)}function i(){return csbc.deepClone(A)}function c(n,e){return o(function(){z(y)(function(n){_.isFunction(n)?(v.get=csbc.deepClone(n),A=csbc.deepClone(n())):A=csbc.deepClone(n),v.receive("csbindReceive"+m,f)},n,e)},e)(),x}function s(n,e){return o(function(){B(y,h,F,i())(function(n){v.send("csbindSend"+m,n)},n,e)},e)(),x}function f(n,e){o(function(){H(y,b,C,i())(function(n){u(I(i(),n))&&(a(v.updates,i(),n),p())},n,e)},e)()}function l(n,e){return o(function(){G(function(n){v.updates=_.cat(d(v.updates,[]),n)},n,e)},e)(),x}function p(){v.send("csbindSend"+m,{values:i(),mode:"check"})}var v,m,y,g,h,b,A,x,j,F,C;return g=["insert","edit","add","remove"],h=_.cat(g,[]),b=_.cat(g,["changeAll"]),j={edit:["index","values","mode"],insert:["index","values","mode"],remove:["index","mode"],add:["values","mode"]},F=_.merge(j,{}),C=_.merge(j,{changeAll:["values","mode"]}),o(function(){U(function(n,e,t){m=n,v=_.selectKeys(e,["receive","send"]),y=_.clone(t)},n,e,t,r)},r)(),x={start:c,set:s,addUpdates:l,get:i}}var p=function(n){return function(e){var t;return t=_.isFunction(e)?e():csbc.deepClone(e),v(t,n)}},v=function(n,e){return u(function(n){return _.isObject(n)&&t.apply(t,e)(n)})(n)},m=function(n,e){return function(r){return _.has(r,e)&&_.has(n,r[e])&&t.apply(t,n[r[e]])(r)}},y=e("第一引数はstring形式である必要があります。",_.isString),g=t("receive","send"),h=e("第二引数のハッシュの値は関数である必要があります。",function(n){return _.every(n,function(n){return _.isFunction(n)})}),b=e("第三引数の値は文字列の配列である必要があります。",u(_.isString)),A=e("第四引数は関数である必要があります。",s(_.isFunction)),x=function(n){return e("第一引数はオブジェクトの配列(キーとして"+n.join(", ")+"を持つ)かそれを返す関数である必要があります。",p(n))},j=e("第二引数は関数である必要があります。",s(_.isFunction)),F=function(n,t){return e("第一引数にはmodeプロパティが必要です。またmodeプロパティがedit,insertの時はvalues、indexプロパティ、removeの場合はindexプロパティ、addの場合はvaluesプロパティが追加で必要です。",m(n,t))},C=function(n,t){return e("第一引数のindexプロパティは範囲内の整数である必要があります。",function(e){return!_.contains(n,e.mode)||f(e.index,0,t.length)})},D=function(n){return e("第一引数のmodeプロパティは"+n.join()+"のいずれかである必要があります。",function(e){return r("mode",n)(e)})},w=function(n,t){return e("第一引数のvaluesプロパティはオブジェクトの配列(キーとして"+n.join(", ")+"を持つ)である必要があります。",function(e){return!_.contains(t,e.mode)||v(e.values,n)})},O=e("第二引数は関数である必要があります。",s(_.isFunction)),S=e("第一引数の値は関数の配列である必要があります。",u(_.isFunction)),E=e("第二引数は関数である必要があります。",s(_.isFunction)),k=function(n,e){return"insert"===e.mode&&Array.prototype.splice.apply(n,_.cat([e.index,0],e.values)),n},q=function(n,e){return"edit"===e.mode&&Array.prototype.splice.apply(n,_.cat([e.index,e.values.length],e.values)),n},K=function(n,e){return"add"===e.mode&&Array.prototype.push.apply(n,e.values),n},N=function(n,e){return"remove"===e.mode&&Array.prototype.splice.apply(n,[e.index,1]),n},R=function(n,e){return"changeAll"===e.mode&&(n=e.values),n},U=i([y],[g,h],[b],[A]),z=function(n){return i([x(n)],[j])},B=function(n,e,t,r){return i([F(t,"mode"),C(["insert","edit","remove"],r),D(e),w(n,["add","insert","edit"])],[O])},G=i([S],[E]),H=function(n,e,t,r){return B(n,e,t,r)},I=c(k,q,N,K,R);csbc.observable=l}();